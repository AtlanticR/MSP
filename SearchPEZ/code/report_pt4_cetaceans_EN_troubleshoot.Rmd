## **CETACEANS**

This section...

```{r Set up paths for Cetacean section, include=FALSE, cache=FALSE}
#read narwc file
narwcFile <- file.path("../../../Data/NaturalResources/Species/Cetaceans/NARWC","NARWC_09-18-2020.csv")
narwc <- read.csv(narwcFile)
narwc <- narwc[which(narwc$YEAR>=minYear),]
#read wsdb file
wsdbFile <- file.path("../../../Data/NaturalResources/Species/Cetaceans/WSDB","MarWSDBSightingsForCGomez_27Oct2020.csv")
wsdb <- read.csv(wsdbFile)
wsdb <- wsdb[which(wsdb$YEAR>=minYear),]
#read cws file
cws<-read.csv("../../../Data/NaturalResources/Species/CWS_ECCC/CWS_ECCC_OBIS_records.csv")
cws<-subset(cws,year>minYear)
#read iNaturalist file
inat<-read.csv("../../../Data/NaturalResources/Species/OBIS_CBIF_iNaturalist/iNaturalist_MAR_priority_records.csv")
inat<-subset(inat,datetime>minYear)
#convert fin whale raster to sf object
fin_whale<- raster("../../../Data/NaturalResources/Species/Cetaceans/PriorityAreas_FGP/Fin_Whale.tif")
fin_whale[fin_whale==0] <- NA
fin_whale_sf<-st_as_stars(fin_whale)%>%st_as_sf()
#convert harbour porpoise raster to sf object
harbour_porpoise<- raster("../../../Data/NaturalResources/Species/Cetaceans/PriorityAreas_FGP/Harbour_Porpoise.tif")
harbour_porpoise[harbour_porpoise==0] <- NA
harbour_porpoise_sf<-st_as_stars(harbour_porpoise)%>%st_as_sf()
#convert humpback whale raster to sf object
humpback_whale<- raster("../../../Data/NaturalResources/Species/Cetaceans/PriorityAreas_FGP/Humpback_Whale.tif")
humpback_whale[humpback_whale==0] <- NA
humpback_whale_sf<-st_as_stars(humpback_whale)%>%st_as_sf()
#convert sei whale raster to sf object
sei_whale<- raster("../../../Data/NaturalResources/Species/Cetaceans/PriorityAreas_FGP/Sei_Whale.tif")
sei_whale[sei_whale==0] <- NA
sei_whale_sf<-st_as_stars(sei_whale)%>%st_as_sf()
#convert bluewhale shape file crs
Blue_32198 <- st_read("../../../Data/NaturalResources/Species/Cetaceans/BlueWhaleHabitat_FGP/BlueWhaleHabitat_HabitatBaleineBleue.shp", quiet=TRUE)
Blue_4326 <- st_transform(Blue_32198, crs = 4326)
Blue_4326b<-setNames(Blue_4326, replace(names(Blue_4326), names(Blue_4326) == 'activitÃ©', 'activite'))
Blue_4326b<-setNames(Blue_4326, replace(names(Blue_4326), names(Blue_4326) == 'activity', 'Activity'))
```

### **Whale Sightings Database (WSDB)**  
Contact: <XMARWhaleSightings@dfo-mpo.gc.ca>  
URL: <http://www.inter.dfo-mpo.gc.ca/Maritimes/SABS/popec/sara/Database>  
Last retrieved on: October 27 2020  
Quality Tier: Low  
Search year: 2002-2020  
Security level: none  

#### ***Area-specific WSDB search results***

```{r read wsdb and filter SARA & COSEWIC cetacean spp, include=FALSE, cache=FALSE}
wsdb_filter <- filter_wsdb(wsdb)
wsdb_filter <- wsdb_filter %>% rename(Scientific_Name = SCIENTIFICNAME)
wsdb_filter <- merge(wsdb_filter, listed_cetacean_species, by='Scientific_Name')
```

```{r echo=FALSE, results='asis'}
wsdb_plot_locations<-st_as_sf(wsdb_filter, coords = c("LONGITUDE", "LATITUDE"), crs = 4326)
intersect_wsdb <- st_intersection(wsdb_plot_locations,PEZ_poly_st)
Common_Name<-intersect_wsdb$Common_Name
Scientific_Name<-intersect_wsdb$Scientific_Name
intersect_wsdb_df<-as.data.frame(cbind(Common_Name, Scientific_Name, row.names = FALSE))

#append columns from listed species 
wsdb_table<-merge(intersect_wsdb_df, listed_cetacean_species, by='Scientific_Name')
x<-as.numeric(nrow(wsdb_table))
wsdb_table<-wsdb_table %>% 
  transmute(Common_Name, Scientific_Name, Schedule.status, COSEWIC.status, Wild_Species)
wsdb_table<- wsdb_table %>% rename("SARA status"=Schedule.status,
                                   "COSEWIC listing"=COSEWIC.status,
                                   "Wild Species listing"=Wild_Species,
                                   "Scientific Name"=Scientific_Name,
                                   "Common Name"=Common_Name)
Total_number_records_WSDB <- length(wsdb_table)
```

*
```{r, comment="", prompt=TRUE, echo=FALSE, results='asis'}
Query_output_wsdb<-if(Total_number_records_WSDB < 1){
  "There are no relevant records in the WSDB for this search area."
} else {
  "There are relevant records in the WSDB for this search area."
}
Query_output_wsdb<-noquote(Query_output_wsdb)
writeLines(Query_output_wsdb)
```

```{r Fig 3 Whale Sightings Database, fig.height=8, fig.width=11, fig.cap="Quality Tier: Low. Security level: none. Observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild Species listings. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This table also does not include acoustic detections."}
par(mfrow = c(1,2), mar=c(0, 0, 5.5, 0) + 2)#it goes c(bottom, left, top, right)
wsdb_plot<-site_map_new(PEZ_poly,PEZ_poly_st,site_sf,land_sf,5)+
  geom_point(data = wsdb_filter, aes(x = LONGITUDE, y = LATITUDE, color=Common_Name), 
             size = 3.5)
if(Total_number_records_WSDB > 1){print(wsdb_plot + scale_colour_manual(values=c("darkgoldenrod1", "chartreuse4", "black", "#00AFBB","#B337A3", "#0827EF", "#EF6408", "#F5A4E7")))}

```

### **The Whitehead Lab, Dalhousie University**
URL: <https://whiteheadlab.weebly.com/contact.html>  
Last retrieved on: January 12 2021  
Quality Tier: High  
Search year: 2002-2019  
Security level: none 

#### ***Area-specific Whitehead Lab search results***

**Figure:**: Quality Tier: High. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Map displays information from the Whitehead Lab, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listing. Field efforts were primarily conducted in the Gully Marine Protected Area, and adjacent canyons along the edge of the eastern Scotian Shelf, during good weather conditions (for example, see Whitehead 2013 for a map of effort between 1988-2011), though some data from surveys along the shelf edge off Nova Scotia, Newfoundland and Labrador are included. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. This map also does not include acoustic detections. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. For more information, please visit: <https://whiteheadlab.weebly.com/contact.html>

### **North Atlantic Right Whale Consortium (NARWC) Sightings Database**  
Contact: <hpettis@neaq.org>  
URL: <https://www.narwc.org/sightings-database.html>  
Last retrieved on: September 18 2020  
Quality Tier: High  
Search year: 2000-2019  
Security level: none  

#### ***Area-specific NARWC search results***
```{r read narwc and filter SARA & COSEWIC cetacean spp, include=FALSE, cache=FALSE}
narwc_filter <- filter_narwc_new(narwc)
narwc_filter <- narwc_filter %>% rename(Scientific_Name = SPECCODE)
narwc_filter <- merge(narwc_filter, listed_species, by='Scientific_Name')
```
```{r echo=FALSE, results='asis'}
narwc_plot_locations<-st_as_sf(narwc_filter, coords = c("LONGITUDE", "LATITUDE"), crs = 4326)
intersect_narwc <- st_intersection(narwc_plot_locations,PEZ_poly_st)
Common_Name<-intersect_narwc$Common_Name
Scientific_Name<-intersect_narwc$Scientific_Name
intersect_narwc_df<-as.data.frame(cbind(Common_Name, Scientific_Name, row.names = FALSE))

#append columns from listed species 
narwc_table<-merge(intersect_narwc_df, listed_species, by='Scientific_Name')
narwc_table<-narwc_table %>% 
  transmute(Common_Name, Scientific_Name, Schedule.status, COSEWIC.status, Wild_Species)
narwc_table<- narwc_table %>% rename("SARA status"=Schedule.status,
                                     "COSEWIC listing"=COSEWIC.status,
                                     "Wild Species listing"=Wild_Species,
                                     "Scientific Name"=Scientific_Name,
                                     "Common Name"=Common_Name)
narwc_species<-length(narwc_table)
```

*
```{r, comment="", prompt=TRUE, echo=FALSE, results='asis'}
Query_output_narwc<-if(narwc_species < 1){
  "There are no relevant records in the NARWC data base for the defiend search area."
} else {
  "There are relevant records in the NARWC data base for the defiend search area."
}
Query_output_narwc<-noquote(Query_output_narwc)
writeLines(Query_output_narwc)
```

```{r NARWC Database, fig.height=8, fig.width=11, fig.cap="Quality Tier: High. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Map displays information from the North Atlantic Right Whale Consortium (NARWC) Sightings Database, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listing. <b>Absence of a species in the map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area</b> since survey effort is biased towards the Northeast US, and data on species presence from acoustic detections is not included. For more information, please visit: https://www.narwc.org/sightings-database.html"}
par(mfrow = c(1,2), mar=c(0, 0, 5.5, 0) + 2)#it goes c(bottom, left, top, right)
narwc_plot<-site_map_new(PEZ_poly,PEZ_poly_st,site_sf,land_sf,5)+
  geom_point(data = narwc_filter, aes(x = LONGITUDE, y = LATITUDE, color=Common_Name), 
             size = 3.5)
if(narwc_species > 1){print(narwc_plot + scale_colour_manual(values=c("darkgoldenrod1", "chartreuse4", "black", "#00AFBB","#B337A3", "#0827EF", "#EF6408", "#F5A4E7")))}
```

### **Ocean Biodiversity Information System (OBIS) [for cetaceans]**  
Contact: <helpdesk@obis.org>  
URL: <https://obis.org/>  
Last retrieved on: January 27 2021 from OBIS  
Quality Tier: Medium  
Search year: 2002-2020  
Security level: none  

#### ***Area-specific OBIS cetacean search results***
```{r, include=FALSE, cache=FALSE}
#Select columns of interest from OBIS file
obis_edit<-obis %>% 
  transmute(scientificName, decimalLatitude, decimalLongitude, year,individualCount, rightsHolder, institutionID, institutionCode, collectionCode, datasetID)
 
#Separate CWS/ECCC records
#CWS.ECCC.OBIS_records<-filter(obis_edit, institutionCode=="Canadian Wildlife Service-Atlantic, Environment and Climate Change Canada")
#write.csv(CWS.ECCC.OBIS_records, "CWS_ECCC_OBIS_records.csv")

#Delete WSDB and CWS/ECCC records
obis_edit2<-obis_edit %>%
  filter(! institutionCode =="Canadian Wildlife Service-Atlantic, Environment and Climate Change Canada")
obis_edit3<-obis_edit2 %>%
  filter(! collectionCode =="WHALESITINGS")

obis_plot_locations<-st_as_sf(obis_edit3, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326)
intersect_obis <- st_intersection(obis_plot_locations,PEZ_poly_st)

#summarize individual counts
#species_sum<-aggregate(intersect_obis$individualCount, by=list(Species=intersect_obis$scientificName), FUN=sum)

#append columns from listed species
intersect_obis<- intersect_obis %>% rename(Scientific_Name=scientificName)

obis_whale_table<-merge(intersect_obis, listed_cetacean_species, by='Scientific_Name')
obis_whale_table<-obis_whale_table %>% 
  select(Common_Name, Scientific_Name, Schedule.status, COSEWIC.status, Wild_Species)
obis_whale_table<- obis_whale_table %>% rename("SARA status"=Schedule.status,
                                               "COSEWIC listing"=COSEWIC.status,
                                               "Wild Species listing"=Wild_Species,
                                               "Scientific Name"=Scientific_Name,
                                               "Common Name"=Common_Name)
obis_whale_table$geometry<-NULL
obis_whale_table<-unique(obis_whale_table)
obis_cetacean_species<-length(obis_whale_table)
```

*
```{r, comment="", prompt=TRUE, echo=FALSE, results='asis'}
Query_output_obis<-if(obis_cetacean_species < 1){
  "There are no relevant records of cetaceans in the Ocean Biodiversity Information System (OBIS) for this search area."
} else {
  "There are relevant records of cetaceans in the Ocean Biodiversity Information System (OBIS) for this search area."
}
writeLines(Query_output_obis)
```

```{r Fig 5 OBIS records for cetacean section in PEZ polygon, fig.height=8, fig.width=11, fig.cap="Quality Tier: Medium. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Map displays information from the Ocean Biodiversity Information System (OBIS), for cetacean species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listing. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore."}

if(obis_cetacean_species > 1){
  plot_obis(PEZ_poly,PEZ_poly_st,site_sf,land_sf,intersect_obis,2)
}
```

### **Species Distribution Models (SDM): Priority Areas to Enhance Monitoring of Cetaceans**  

Contact: <Hilary.Moors-Murphy@dfo-mpo.gc.ca>  
Site: <https://waves-vagues.dfo-mpo.gc.ca/Library/40869155.pdf>  
Last retrieved on: April 1 2020 from Open Data <https://open.canada.ca/data/en/dataset/c094782e-0d6f-4cc0-b5a3-58908493a433>  
Quality Tier: Medium  
Search year: 1975-2015  
Security level: none.

#### ***Area-specific SDM cetacean search results***

```{r echo=FALSE, results='asis'}
#function for overlap
fin_area<-fin_overlap(fin_whale_sf, PEZ_poly_st)
harbour_area<-harbour_overlap(harbour_porpoise_sf, PEZ_poly_st)
humpback_area<-humpback_overlap(humpback_whale_sf, PEZ_poly_st)
sei_area<-sei_overlap(sei_whale_sf, PEZ_poly_st)
cetacean_matrix<-data.frame(Fin_Whale="",Habour_Porpoise="", Humpback_Whale="", Sei_Whale="")
cetacean_matrix[1,1]<-fin_area
cetacean_matrix[1,2]<-harbour_area
cetacean_matrix[1,3]<-humpback_area
cetacean_matrix[1,4]<-sei_area
cetacean_matrix<- cetacean_matrix %>% rename("Fin Whale"=Fin_Whale,
                                     "Habour Porpoise"=Habour_Porpoise,
                                     "Humpback Whale"=Humpback_Whale,
                                     "Sei Whale"=Sei_Whale)
```

```{r}
kable(cetacean_matrix, align="c", caption="Quality Tier: Low. Security level: none. Results showing if the search area overlap with predicted Priority Areas to Enhance Monitoring of several species of cetaceans (Fin Whale, Harbour Porpoise, Humpback Whale and Sei Whale). TRUE = polygon does overlap with priority area; FALSE = polygon does NOT overlap with priority area.") %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

```{r Fig X priority areas for cetaceans, fig.height=8, fig.width=11, fig.cap="Quality Tier: Low. Security level: none. Map shows consolidated Species Distribution Modelling outputs (60-100% relative predicted occurrence rate). Yellow polygons (habitats with high suitability) are to be interpreted as areas where cetacean monitoring efforts may be prioritized, and results can help direct future survey efforts. Due to the many reasons listed in the discussion section in Gomez et al. (2020), these cetacean modelling outputs do not represent a complete and current distribution of cetaceans in the region. They represent priority areas to direct cetacean monitoring efforts. Their use in marine spatial planning processes should be accompanied by complementary approaches such as the process summarized in the section below. The data product summarized in the section below (Blue Whale Important Habitat in the Western North Atlantic) represents an excellent framework in which to properly use the outputs of this figure."}
plot_cetaceans_4grid(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei_whale_sf, PEZ_poly_st, land_sf)
```

### **Blue Whale Important Habitat**  

Blue Whale Important Habitat in the Western North Atlantic  
Contact: <gddaiss-dmsaisb@dfo-mpo.gc.ca>  
URL: <https://waves-vagues.dfo-mpo.gc.ca/Library/40687776.pdf>  
Last retrieved on: October 30 2020 from Open Data <https://open.canada.ca/data/en/dataset/8fafd919-fcbe-43a3-a911-3d9461273441>  
Quality Tier: High  
Security level: none.  

#### ***Area-specific Blue Whale Important Habitat search results***

*    
```{r echo=FALSE, results='asis'}
#function for overlap
BW<-blue_whale_habitat_overlap(Blue_Whale_shp=Blue_4326b, PEZ_poly_st= PEZ_poly_st)
writeLines(BW)
```

```{r echo=FALSE, results='asis'}
#function for sector
blue_whale_habitat_sector(Blue_Whale_shp=Blue_4326b, PEZ_poly_st= PEZ_poly_st)
```

```{r echo=FALSE, results='asis'}
#function for activity
blue_whale_habitat_activity(Blue_Whale_shp=Blue_4326b, PEZ_poly_st= PEZ_poly_st)
```

```{r echo=FALSE, results='asis'}
#function for months
blue_whale_habitat_months(Blue_Whale_shp=Blue_4326, PEZ_poly_st= PEZ_poly_st)
```

```{r Fig X PEZ polygon with all maritime blue whale habitat polygons, fig.height=8, fig.width=11, fig.cap="Quality Tier: High. Security level: none. Blue Whale Important Habitat in the Western North Atlantic. Polygons delimit areas in Canadian waters that are important to Blue Whales for foraging (dark green) and transit (light green). These areas identified in the report by Lesage et al. (2018) are considered important for the survival and recovery of Blue Whales from the western North Atlantic population. Blue Whales most likely need to use several of these important habitats to fulfill their biological needs. As a result, access corridors and habitat they connect need to be considered equally important for the population."}
plot_bw_hab(Blue_4326b, PEZ_poly_st, land_sf)
```

```{r Fig X close up of PEZ polygon and bw habitat, fig.height=8, fig.width=11, fig.cap="Zoomed in view of figure above."}
plot_bw_hab_zoom(Blue_4326b, PEZ_poly_st, land_sf)
```

### **Northern Bottlenose Whale Important Habitat**  
Northern bottlenose whales important habitat in inter-canyon areas on the eastern Scotian Shelf  
Contact: <MaritimesRAP.XMAR@dfo-mpo.gc.ca>  
URL: <http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf>  
Last retrieved on: February 17 2021 from Maritimes Region   
Quality Tier: High  
Security level: none.  

#### ***Area-specific Northern Bottlenose Whale Important Habitat search results***  

* "Search area overlaps with Northern Bottlenose Whales important habitat in inter-canyon areas on the eastern Scotian Shelf " OR "Search area does not overlaps with Northern Bottlenose Whales important habitat in inter-canyon areas on the eastern Scotian Shelf."  

Figure x. Quality Tier: High. Security level: none. Proposed Northern Bottlenose Whales important habitat in inter-canyon areas on the eastern Scotian Shelf. Northern Bottlenose Whales are present year-round in the inter-canyon areas, which function as foraging habitat and movement corridors. Note that the full extent of important habitat for Scotian Shelf Northern Bottlenose Whales remains unknown. Please see additional information in <a href="http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf">DFO 2020</a>.  

