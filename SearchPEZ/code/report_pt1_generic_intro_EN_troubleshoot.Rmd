---
title: "Reproducible Report for Species in Maritimes Region - for Internal DFO use only"
author: Synthesis prepared by the Reproducible Reporting Team, steering committee and advisors.
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  bookdown::html_document2:
    number_sections: FALSE
    toc: true
    toc_depth: 5
    theme: journal
---
<style>
table {background-color: white !important;color: black !important;}
caption {color: black !important;}
a:link {color: #002080;}
a:visited {color: #008040;}
a:hover {color: #006080;}
</style>

```{r load packages, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, fig.align="left")
library(easypackages)
libraries("Mar.datawrangling","knitr","kableExtra","rgdal","maps","lubridate","raster","RCurl","sf","stringr","ggplot2","data.table","gridExtra","dplyr","stars","ggspatial","tidyverse")
#These next two lines are necessary for the generation of the water mark on all plots.
#install.packages("remotes")
#remotes::install_github("terminological/standard-print-output")
library(standardPrintOutput)
```
```{r load source functions, include=FALSE, cache=FALSE}
source("site_map.r")
source("filter_wsdb.r")
source("filter_narwc_new.r")
source("EBSA.R")
source("leatherback.R")
source("cetacean_priority_areas.R")
source("Blue_Whale_habitat.R")
source("fn_SearchRVData.r")
source("fn_Search_ISDB_Data.r")
source("fn_maps.r")
source("fn_Search_MARFIS_Data.r")
```
```{r Define Site, include=FALSE, cache=FALSE}
AquaSiteName <- "AtlanticDestiny"
PEZversion <- "60km"
minYear <- 2002
```
```{r set up paths, include=FALSE, cache=FALSE}
mspPath <- "../"
data.dir = "../../../Data/mar.wrangling"
# this isn't used.  Remove probably
# dataPath <- file.path("../../../Data/outputs",paste0(AquaSiteName,PEZversion))
# this path works for PRG when at BIO
polyPath <- "../../../Data/Zones/SearchPEZpolygons"

pl <- list.files(polyPath,"*.shp") # get a list of shapefiles in the SeachPEZ folder
pl <- pl[-grep("xml",pl)] # remove xml files from list
#pl <- pl[-grep("lock",pl)] # remove any lock files from list

# read in the site boundary, a landbase file and the Search polygon
site_sf <- st_read(file.path(polyPath,pl[grep(paste0("Site_",AquaSiteName),pl)]))
land_sf<-st_read("../../../Data/Boundaries/Coast50K/Coastline50k_SHP/Land_AtlCanada_ESeaboardUS.shp", quiet=TRUE)
PEZ_poly <- readOGR(file.path(polyPath,pl[grep(paste0("PEZ_",AquaSiteName,PEZversion),pl)]))
PEZ_poly_sf<-st_as_sf(PEZ_poly)
```
```{r load SAR species lists, include=FALSE, cache=FALSE}
listed_species<-read.csv("../../../Data/NaturalResources/Species/MAR_listed_species.csv")
cetacean_list<-c("Beluga Whale", "Humpback Whale" , "North Atlantic Right Whale", "Fin Whale", "Northern Bottlenose Whale", "Harbour Porpoise", "Killer Whale", "Blue Whale", "Sei Whale", "Sowerby's Beaked Whale")
other_species_list<-c("Loggerhead Sea Turtle", "Atlantic Walrus", "Harbour Seal Lacs des Loups Marins subspecies", "Leatherback Sea Turtle")
listed_cetacean_species<-subset(listed_species, Common_Name %in% cetacean_list)
listed_other_species<-subset(listed_species, Common_Name %in% other_species_list)
listed_fish_invert_species<-listed_species[ ! listed_species$Common_Name %in% c(other_species_list,cetacean_list), ]
```
```{r load databases used in multiple sections, include=FALSE, cache=FALSE}
obis<-read.csv("../../../Data/NaturalResources/Species/OBIS_GBIF_iNaturalist/OBIS_MAR_priority_records.csv")
obis<-subset(obis,year>minYear)
```

# **REPRODUCIBLE REPORTING**    

#### **About this report**    

This document summarizes regional data, including information on species and habitats, available at the time of report creation. â€¦
 
#### **How to use this report?**    

  -  This document

# **SEARCH RESULTS: EMPHASIS ON SPECIES LISTED BY THE <i>SPECIES AT RISK ACT</i>, ASSESSED BY THE COMMITTEE ON THE STATUS OF THE ENDANGERED WILDLIFE IN CANADA (COSEWIC) AND/OR WILD SPECIES**    

```{r echo=FALSE, results='asis'}
List_table<-data.frame("Framework"="", Description = "")
List_table[1,1]<-"SARA"
List_table[2,1]<-"COSEWIC"
List_table[3,1]<-"Wild Species"
```
```{r}
kable(
  List_table,
  align="l", 
  caption = "\\label{tab:List_table}Definitions relevant for species listed by <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild Species listings.",
booktabs = T,
escape = F,
linesep="")%>%
column_spec(1,width = "3cm")%>%
  kable_styling(bootstrap_options = "striped", full_width = T, position = "left")
```

```{r child = 'report_pt2_SAR_dist_crithab_EN_troubleshoot.Rmd'}
```

```{r child = 'report_pt3_fish_inverts_EN_troubleshoot.Rmd'}
```

```{r child = 'report_pt4_cetaceans_EN_troubleshoot.Rmd'}
```

```{r child = 'report_pt5_Habitat_Information_EN_troubleshoot.Rmd'}
```

```{r child = 'report_pt6_EBSA_EN_troubleshoot.Rmd'}
```

#```{r child = 'report_pt7_generic_END_EN.Rmd'}
#```

