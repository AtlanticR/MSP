## **FISH AND INVERTEBRATES**    

This section...

### **Maritimes Research Vessel (RV) Survey**    

Contact: <DFO.MAR-PED-Data-Request-Demande-de-donnes-DEP-MAR.MPO@dfo-mpo.gc.ca>  
Last retrieved on: January 21, 2021 from [Open Data](https://open.canada.ca/data/en/dataset/8ddcaeea-b806-4958-a79f-ba9ab645f53b)  
Quality Tier: High  
Search year: 1970-2020  
Security level: none  

#### ***Area-specific Maritimes Research Vessel (RV) Survey search results***    

```{r, include=FALSE, cache=FALSE}
RVCatch_sf <- RVCatch_sf %>% dplyr::filter(YEAR >= minYear)
RVCatch_intersect <- st_intersection(RVCatch_sf,studyArea)
rv_SAR_table<-table_rv_SAR(RVCatch_intersect)
rv_table <- table_rv(RVCatch_intersect)
```

*
```{r, comment="", prompt=TRUE, echo=FALSE, results='asis'}
Report_RV<-if(length(rv_SAR_table) < 1){
    "There are no relevant records in the Maritimes Research Vessel (RV) Survey for this search area."
  } else {
    "There are relevant records in the Maritimes Research Vessel (RV) Survey for this search area."
  }
Report_RV<-noquote(Report_RV)
writeLines(Report_RV)
```

```{r}
#Convert geometry to latitude and longitude
RVCatch_intersect <- RVCatch_intersect %>% extract(geometry, c('long', 'lat'), '\\((.*), (.*)\\)', convert = TRUE)
rv_start_sites<-data.frame(unique(cbind(longitude=RVCatch_intersect$lon, latitude=RVCatch_intersect$lat)))
rv_end_sites<-data.frame(unique(cbind(longitude=RVCatch_intersect$ELONG, latitude=RVCatch_intersect$ELAT)))
startx <- rv_start_sites$longitude
starty <- rv_start_sites$latitude
endx <- rv_end_sites$longitude
endy <- rv_end_sites$latitude
```

<br><br>

```{r, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Buffer area was used to query information from the Maritimes Research Vessel (RV) Survey. Black lines and arrows indicate the location and direction of each bottom otter trawl sample.'}
site_map(studyArea,site_sf,land10m_sf,10)+
  geom_point(data = rv_start_sites, aes(x = longitude, y = latitude), size = 3, 
        shape = 16, colour = "darkgreen")+
  geom_point(data = rv_end_sites, aes(x = longitude, y = latitude), size = 3, 
        shape = 16, colour = "firebrick4")+
  geom_segment(aes(x = startx, y = starty, xend = endx, yend = endy),arrow=arrow(length = unit(0.2,"cm")), size = 1)
```

<br><br>

```{r}
kable(rv_SAR_table, align="l", caption="\\label{tab:rv_SAR_table}Quality Tier: High. Security level: none. Maritimes Research Vessel (RV) Survey observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listing (B=Breeding, N=non-breeding, M=migratory). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>", booktabs = T, escape = F, linesep="") %>%
  kable_styling(bootstrap_options = "striped", full_width = T, position = "left", fixed_thead=T)

```

<br><br>

```{r}
kable(rv_table, align="l", caption="\\label{tab:rv_freq_table}Quality Tier: High. Security level: none. Maritimes Research Vessel (RV) Survey observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>", booktabs = T, escape = F, linesep="") %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

<br><br>

### **Industry Survey and Maritimes Fishery Databases**    

#### ***Industry Survey Database (ISDB)***    
Contact: <Claire.Mussells@dfo-mpo.gc.ca>  
```{r echo=FALSE, results='asis'}
info<-file.info("../../../Data/mar.wrangling/ISDB.ISSETTYPECODES.RData")
LatestUpdate<-format(info[,"mtime"], format = "%B %d %Y")
last_retrieved<-c("Last retrieved on: ",LatestUpdate)
writeLines(c("Last retrieved on:",LatestUpdate), sep = " ") 
```
Quality Tier: Medium  
Search year: 2002-2019  
Security level: Protected B  

#### ***The Maritime Fishery Information System (MARFIS)***    
Contact: <XMARComData@dfo-mpo.gc.ca>  
```{r echo=FALSE, results='asis'}
info<-file.info("../../../Data/mar.wrangling/MARFISSCI.PRO_SPC_INFO.RData")
LatestUpdate<-format(info[,"mtime"], format = "%B %d %Y")
last_retrieved<-c("Last retrieved on: ",LatestUpdate)
writeLines(c("Last retrieved on:",LatestUpdate), sep = " ")
```
Quality Tier: Medium  
Search year: 2002-2019  
Security level: Protected B  

#### ***Area-specific MARFIS & ISDB search results***    
```{r, include=FALSE, cache=FALSE}
isdb1 <- isdb1 %>% dplyr::filter(YEAR >= minYear)
isdb_sf <- st_as_sf(isdb1, coords = c("LONGITUDE", "LATITUDE"), crs = 4326)
isdb_intersect <- st_intersection(isdb_sf,studyArea)
isdb_intersect <- isdb_intersect %>% extract(geometry, c('long', 'lat'), '\\((.*), (.*)\\)', convert = TRUE)
isdb_sites<-data.frame(longitude=isdb_intersect$long, latitude=isdb_intersect$lat)
isdb_table<-table_isdb(isdb_intersect)
isdb_SAR_table<-table_isdb_SAR(isdb_intersect)
```

```{r}
Total_number_records_isdb <- sum(isdb_table$Records)
Total_number_SAR_records_isdb<-sum(isdb_SAR_table$Records)
isdb_summary_table<-data.frame(Total_organisms_recorded_in_polygon="", LISTED_organisms_recorded_in_polygon="")
isdb_summary_table[1,1]<-Total_number_records_isdb
isdb_summary_table[1,2]<-Total_number_SAR_records_isdb
isdb_summary_table<- isdb_summary_table %>% rename("Total organisms recorded in polygon"=Total_organisms_recorded_in_polygon,
                                                   "Listed organisms recorded in polygon"=LISTED_organisms_recorded_in_polygon)
```

```{r, include=FALSE, cache=FALSE}
marfis1$YEAR <- lubridate::year(marfis1$DATE_FISHED)
marfis1 <- marfis1 %>% dplyr::filter(YEAR >= minYear)
marfis_sf <- st_as_sf(marfis1, coords = c("LONGITUDE", "LATITUDE"), crs = 4326)
marfis_intersect <- st_intersection(marfis_sf,studyArea)
marfis_intersect <- marfis_intersect %>% extract(geometry, c('long', 'lat'), '\\((.*), (.*)\\)', convert = TRUE)
marfis_sites<-data.frame(longitude=marfis_intersect$long, latitude=marfis_intersect$lat)
marfis_table<-table_marfis(marfis_intersect)
marfis_SAR_table<-table_marfis_SAR(marfis_intersect)
```

```{r}
Total_number_records_marfis <- sum(marfis_table$Records)
Total_number_SAR_records_marfis <- sum(marfis_SAR_table$Records)
marfis_summary_table<-data.frame(Total_organisms_recorded_in_polygon="", LISTED_organisms_recorded_in_polygon="")
marfis_summary_table[1,1] <- Total_number_records_marfis
marfis_summary_table[1,2] <- Total_number_SAR_records_marfis
marfis_summary_table <- marfis_summary_table %>% rename("Total organisms recorded in polygon"=Total_organisms_recorded_in_polygon,
                                                        "Listed organisms recorded in polygon"=LISTED_organisms_recorded_in_polygon)
```

*
```{r, comment="", prompt=TRUE, echo=FALSE, results='asis'}
Report_isdb<-if(Total_number_SAR_records_isdb < 1){
    "There are no relevant records in the Industry Survey Database (ISDB) for this search area."
  } else {
    "There are relevant records in the Industry Survey Database (ISDB) for this search area."
  }
Report_isdb<-noquote(Report_isdb)
writeLines(Report_isdb)
```

*
```{r, comment="", prompt=TRUE, echo=FALSE, results='asis'}
Report_marfis<-if(Total_number_SAR_records_marfis < 1){
    "There are no relevant records in the Maritimes Fishery Information System (MARFIS) for this search area."
  } else {
    "There are relevant records in the Maritimes Fishery Information System (MARFIS) for this search area."
  }
Report_marfis<-noquote(Report_marfis)
writeLines(Report_marfis)
```

<br>

```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: Protected B. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Buffer area was used to query aggregated information from Maritimes Fishery Information System (MARFIS) and/or Industry Survey Database (ISDB) observation records shown as black points, for all species. Rule of five was not applied.'}
site_map(studyArea,site_sf,land10m_sf,10)+
  geom_point(data = isdb_sites, aes(x = longitude, y = latitude), size = 3, 
        shape = 16, fill = "black")+
  geom_point(data = marfis_sites, aes(x = longitude, y = latitude), size = 3, 
        shape = 16, fill = "black")
```

<br><br>

```{r}
kable(isdb_SAR_table, align="l", caption="Quality Tier: Medium. Security level: Protected B. Industry Survey Database (ISDB) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listings (B=Breeding, N=non-breeding, M=migratory). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>", booktabs = T, escape = F, linesep="") %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left", fixed_thead=T)
```

<br><br>

```{r}
kable(isdb_table, align="l", caption="Quality Tier: Medium. Security level: Protected B. Industry Survey Database (ISDB) observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>", booktabs = T, escape = F, linesep="") %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left", fixed_thead=T)
```

<br><br>

```{r}
kable(marfis_SAR_table, align="l", caption="Quality Tier: Medium. Security level: Protected B. Maritimes Fishery Information System (MARFIS) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listings (B=Breeding, N=non-breeding, M=migratory). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>", booktabs = T, escape = F, linesep="") %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

<br><br>

```{r}
kable(marfis_table, caption="Quality Tier: Medium. Security level: Protected B. Maritimes Fishery Information System (MARFIS) observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>", booktabs = T, escape = F, linesep="") %>%
column_spec(1, width="15cm") %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left", fixed_thead = T)
```

<br><br>

### **Ocean Biodiversity Information System (OBIS)**    
Contact: helpdesk@obis.org  
Last retrieved on: January 27, 2021 from [OBIS](https://obis.org/)  
Quality Tier: Medium  
Search year: 2002-2020  
Security level: none  

#### ***Area-specific OBIS fish and invertebrate search results***    
```{r, include=FALSE, cache=FALSE}
obis_sf_filter <- filter_obis_fish(obis_sf)
obis_intersect_points_fish <-intersect_points_obis_fish(obis_sf_filter, studyArea)
obis_fish_table <- table_obis_fish(obis_sf_filter, studyArea)
Total_number_fish_records_obis <- nrow(obis_fish_table)
```

*
```{r, echo=FALSE, results='asis',}
Report_obis<-if(Total_number_fish_records_obis < 1){
  "There are no relevant records in the Ocean Biodiversity Information System (OBIS) for this search area."
} else {
  "There are relevant records in the Ocean Biodiversity Information System (OBIS) for this search area."
}
Report_obis<-noquote(Report_obis)
writeLines(c(Report_obis), sep = "\n")
```

```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Buffer area was used to query information from Ocean Biodiversity Information System (OBIS) observation records, for species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC) and Wild species. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.'}
par(mfrow = c(1,2), mar=c(0, 0, 5.5, 0) + 2)#it goes c(bottom, left, top, right)
obis_plot<-site_map(studyArea,site_sf,land10m_sf,10)+
  geom_point(data = obis_intersect_points_fish, aes(x = long, y = lat), size = 3, 
        shape = 16, fill = "black") 
if(Total_number_fish_records_obis > 1){print(obis_plot)}

```

<br><br>

```{r echo=FALSE, results='asis', caption="Priority species with observations contained in the OBIS database within the search polygon area."}
OBIS_query_output_table<-if(Total_number_fish_records_obis < 1){
  ""
} else {
  kable(obis_fish_table, align="l", row.names = F, caption="Quality Tier: Medium. Security level: none. Ocean Biodiversity Information System (OBIS) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild Species listing (B=Breeding, N=non-breeding, M=migratory). <b>The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>",
        booktabs = T, escape = F, linesep="") %>%
    kable_styling(bootstrap_options = "striped", full_width = T, position = "left")}
if(Total_number_fish_records_obis > 1){OBIS_query_output_table}
```
